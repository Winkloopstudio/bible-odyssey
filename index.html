<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Believe 33 – Faith-Based Games</title>
<style>
  :root{
    --bg:#f7e6c7;           /* parchment vibe */
    --panel:#fff7e7;
    --ink:#402d1f;
    --accent:#f59e0b;       /* orange header */
    --accent-dark:#d97706;
    --btn:#28c145;          /* glossy green */
    --btn-dark:#1e9b35;
    --danger:#ef4444;
    --danger-dark:#b91c1c;
    --blue:#2ea8ff;
    --muted:#b8a494;
    --lock:#9aa3af;
    --shadow:0 10px 18px rgba(0,0,0,.18);
    --round:22px;
  }

  @font-face {
  font-family: 'Baloo2';
  src: url('fonts/Baloo2-Regular.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}

@font-face {
  font-family: 'Baloo2';
  src: url('fonts/Baloo2-Bold.ttf') format('truetype');
  font-weight: bold;
  font-style: normal;
}


  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  button{font:inherit}
  .hidden{display:none!important}
  .screen{position:fixed;inset:0;display:flex;flex-direction:column}
  .center{display:flex;align-items:center;justify-content:center}

  /* Splash */
  #splash{background:radial-gradient(1200px 600px at 50% -10%, #fff 0%, #fde9c9 55%, #f5d7a6 100%);}
  .logo{
    text-align:center;
    animation:pop .9s cubic-bezier(.2,1.2,.2,1);
  }
  .logo .mark{
    font-weight:900; font-size:56px; letter-spacing:.5px;
    display:inline-flex; align-items:center; gap:.5rem;
  }
  .logo .mark .badge{
    width:44px;height:44px;border-radius:12px;background:#111;color:#fff;
    display:inline-grid;place-items:center;font-weight:900
  }
.logo small {
  display: block;
  margin-top: 14px;
  font-size: 18px;                 /* a bit larger */
  font-weight: 700;                /* bold */
  color: #5a3520;                  /* deeper warm brown */
  text-shadow: 1px 1px 3px rgba(0,0,0,0.25); /* soft shadow */
  letter-spacing: 0.5px;           /* space out slightly */
}

.splash-sub {
  margin-top: 10px;
  font-size: 16px;
  font-weight: 600;
  color: #f59e0b;                  /* use your orange accent */
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  animation: pulse 2s infinite;    /* make it animate */
}

@keyframes pulse {
  0%   { opacity: 1; transform: scale(1); }
  50%  { opacity: 0.7; transform: scale(1.05); }
  100% { opacity: 1; transform: scale(1); }
}


  .logo-img {
  width: 250px;   /* adjust size */
  height: auto;
  animation: pop .9s cubic-bezier(.2,1.2,.2,1);
}

  /* Header/Ticker */
  header{
    background:linear-gradient(180deg,var(--accent) 0%, var(--accent-dark) 100%);
    color:#fff; padding:.7rem .9rem; box-shadow:var(--shadow);
    display:flex; align-items:center; gap:.7rem; z-index:2;
  }

header strong {
  font-family: 'Baloo2', sans-serif;
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  text-shadow: 1px 2px 3px rgba(0,0,0,0.35);
}

  header .gear{margin-left:auto;border:none;background:transparent;color:#fff;font-size:22px}
.ticker {
  flex: 1;
  overflow: hidden;
  white-space: nowrap;
  position: relative;
}
.ticker span {
  display: inline-block;
  font-family: 'Baloo2', sans-serif; /* or whatever font you choose */
  font-size: 16px;
  font-weight: 700;
  color: #fffde7;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.35);
  letter-spacing: 0.5px;

  white-space: nowrap;      /* prevents line breaks */
  will-change: transform;   /* smooth scrolling on GPU */
}


@keyframes scrollVerse {
  from { transform: translateX(100%); }
  to   { transform: translateX(-100%); }
}


  /* Content wrapper */
  main{flex:1; overflow:auto; position:relative}

  /* Bottom Nav (Number Crunch style) */
  nav.bottom{
    position:fixed; left:0; right:0; bottom:0; z-index:3;
    background:#c68652;  /* warm clay bar behind */
    padding:.5rem .6rem .9rem; 
  }
  .dock{
    background:#e9c6a1;border-radius:18px; display:grid; grid-template-columns:repeat(5,1fr);
    gap:.4rem; padding:.45rem; box-shadow:0 6px 10px rgba(0,0,0,.18) inset, var(--shadow);
  }
  .dock button{
    background:#fff6ea;border:none;border-radius:16px; padding:.5rem .2rem; 
    display:flex; flex-direction:column; align-items:center; gap:.25rem;
    color:#5a4330; font-weight:600;
  }
  .dock button.active{outline:3px solid #fff; box-shadow:0 0 0 2px #00000012 inset}
  .ico{width:22px;height:22px;display:inline-block}

  /* Home screen: story carousel */
  .pad{padding:12px 14px 88px}
  .section-title{font-weight:800; font-size:20px; margin:12px 2px}
  .carousel-wrap{position:relative}
  .strip{
    display:grid; grid-auto-flow:column; grid-auto-columns:72%;
    gap:14px; overflow-x:auto; scroll-snap-type:x mandatory; padding:8px 2px 14px;
  }
  .book{scroll-snap-align:center; background:var(--panel); border-radius:20px; position:relative; box-shadow:var(--shadow); overflow:hidden}
  .book .art {height: 160px;overflow: hidden;border-bottom: 3px solid #e5d4b3;}
.book .art img {display: block;width: 100%;height: 100%;object-fit: cover;}

  .book .cap{padding:10px 12px 12px}
  .tag{display:inline-flex; align-items:center; gap:.35rem; font-size:12px; background:#fff; padding:.25rem .5rem; border-radius:999px; box-shadow:0 2px 6px rgba(0,0,0,.12)}
  .lock{
    position:absolute; inset:0; background:linear-gradient(#00000022,#00000055);
    display:grid; place-items:center; color:#fff; font-weight:800; font-size:18px;
  }
  .lock .badge{background:#00000055; padding:.45rem .65rem; border-radius:12px}
  .pill{
    display:inline-block; margin-top:10px; padding:.6rem .9rem; border-radius:999px; border:none; color:#fff;
    font-weight:800; letter-spacing:.4px; background:linear-gradient(180deg,var(--btn) 0%, var(--btn-dark) 100%); box-shadow:0 6px 0 #167729, 0 10px 18px rgba(0,0,0,.25)
  }
  .pill:active{transform:translateY(1px); box-shadow:0 5px 0 #167729}

  /* Level select (card tiles) */
  .cards{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
  .level-card{
    background:#111; border-radius:16px; color:#fff; position:relative; overflow:hidden; box-shadow:var(--shadow);
  }
  .level-thumb{height:110px; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width=\"400\" height=\"200\"><defs><linearGradient id=\"g\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\"><stop offset=\"0\" stop-color=\"%23ffb703\"/><stop offset=\"1\" stop-color=\"%23fb5607\"/></linearGradient></defs><rect width=\"100%\" height=\"100%\" fill=\"url(%23g)\"/><g fill=\"white\" opacity=\"0.2\"><circle cx=\"60\" cy=\"40\" r=\"20\"/><circle cx=\"160\" cy=\"70\" r=\"26\"/><circle cx=\"300\" cy=\"50\" r=\"18\"/></g></svg>') center/cover no-repeat;}
  .level-foot{display:flex; justify-content:space-between; align-items:center; padding:.6rem .7rem; background:#1a1a1a}
  .level-badge{background:#facc15;color:#000; font-weight:900; padding:.2rem .5rem; border-radius:6px}
  .lock-card{position:absolute; inset:0; display:grid; place-items:center; background:#0008; color:#fff; font-weight:800}

  /* Game area */
  #game{position:fixed;inset:0; background:#e8f8ff; display:none; flex-direction:column}
  .game-top{display:flex; align-items:center; justify-content:space-between; padding:.6rem .7rem; background:#0ea5e9; color:#fff}
  .game-stage{flex:1; display:grid; place-items:center; padding:14px}
  .big-btn{background:#fff; border:none; padding:12px 14px; border-radius:14px; box-shadow:var(--shadow); font-weight:800}

  /* Pause menu (glossy like your ref) */
  .overlay{position:absolute; inset:0; display:none; background:#0006; align-items:center; justify-content:center}
  .pause{
    background:#fffbf0;border-radius:24px; width:min(92vw,420px);
    box-shadow:0 14px 28px rgba(0,0,0,.35); padding:16px 16px 22px; border:4px solid #e2c9a1;
  }
  .pause h3{
    margin:0 0 10px; text-align:center; color:#7a4f2a;
    background:#f0d3a9; border-radius:16px; padding:10px; font-size:22px; font-weight:900
  }
  .row{display:flex; gap:14px; justify-content:space-between; margin:8px 0 12px}
  .round{
    width:66px;height:66px;border-radius:999px; border:none; color:#fff; font-weight:900;
    box-shadow:0 6px 0 #126c25, 0 12px 18px rgba(0,0,0,.2);
    background:linear-gradient(180deg,var(--btn) 0%, var(--btn-dark) 100%);
  }
  .round.blue{background:linear-gradient(180deg,#59c0ff 0%, #2f8fe0 100%); box-shadow:0 6px 0 #1e63a9, 0 12px 18px rgba(0,0,0,.2)}
  .round.yellow{background:linear-gradient(180deg,#ffd84a 0%, #f1b501 100%); box-shadow:0 6px 0 #b88a02, 0 12px 18px rgba(0,0,0,.2); color:#3a2a00}
  .btn-wide{
    display:block; width:100%; border:none; border-radius:999px; margin:10px 0; padding:14px; color:#fff; font-weight:900; 
    background:linear-gradient(180deg,var(--btn) 0%, var(--btn-dark) 100%); box-shadow:0 8px 0 #167729, 0 12px 18px rgba(0,0,0,.2)
  }
  .btn-wide.red{background:linear-gradient(180deg,var(--danger) 0%, var(--danger-dark) 100%); box-shadow:0 8px 0 #7f1d1d}
  .x{position:absolute; top:-10px; right:-10px; background:#ff6b6b; border-radius:999px; border:4px solid #fff; width:34px; height:34px; color:#fff; font-weight:900}

  /* Utility */
  .ghost{opacity:.55}
  .top-pad{padding:8px 14px 0}
  @media (min-width:480px){ .strip{grid-auto-columns:50%} }

  /* Storybook */

  .storybook {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: #fffbe8;
  padding: 12px;
}

.storybook-art {
  flex: 2;
  display: flex;
  justify-content: center;
  align-items: center;
}
.storybook-art img {
  max-width: 100%;
  max-height: 60%;
  border-radius: 12px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.25);
}

.storybook-text {
  flex: 1;
  background: #fffdf5;
  margin-top: 16px;
  padding: 18px 20px;
  border-radius: 18px;
  font-size: 18px;
  font-weight: 600;
  line-height: 1.6;
  color: #3d2b1f;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  border: 3px solid #f7d58c;
  font-family: "Comic Sans MS", "Comic Neue", cursive; /* playful book feel */
  text-align: center; /* centered like story text */
}


.storybook-nav {
  position: fixed;
  bottom: 90px; /* just above your dock height */
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: #fffbe8; /* match story background */
  z-index: 5;
}

  /* Page flip animations */
.page-enter {
  opacity: 0;
  transform: rotateY(90deg) scale(0.95);
}
.page-enter-active {
  opacity: 1;
  transform: rotateY(0deg) scale(1);
  transition: all 0.6s ease;
}
.page-exit {
  opacity: 1;
  transform: rotateY(0deg) scale(1);
}
.page-exit-active {
  opacity: 0;
  transform: rotateY(-90deg) scale(0.95);
  transition: all 0.6s ease;
}

  
.nav-btn {
  background: #28c145;
  color: #fff;
  border: none;
  border-radius: 999px;
  padding: 10px 18px;
  font-weight: 700;
  box-shadow: 0 4px 0 #167729;
}
.nav-btn:disabled { opacity: 0.4; }

.dots {
  display: flex;
  gap: 6px;
}
.dots span {
  width: 10px;
  height: 10px;
  background: #ccc;
  border-radius: 50%;
  display: inline-block;
}
.dots span.active { background: #28c145; }

</style>
</head>
<body>

<!-- SPLASH -->
<section id="splash" class="screen center">
  <div class="logo">
 <img src="images/logo.png" alt="Bible Odyssey Logo" class="logo-img" />
    <small>Faith-Based Games</small>
    <div class="splash-sub">Loading goodness…</div>
  </div>
</section>

<!-- APP SHELL -->
<section id="app" class="screen hidden">
  <header>
    <strong>Bible Odyssey</strong>
    <div class="ticker"><span id="verseTicker"></span></div>
    <button class="gear" id="openSettings" aria-label="Settings">⚙️</button>
  </header>

  <main id="viewContainer">
    <!-- HOME / STORIES -->
    <div id="homeView" class="pad">
      <div class="section-title">Select a Story</div>

      <div class="carousel-wrap">
        <div id="storyStrip" class="strip"></div>
      </div>

      <div class="top-pad">
        <h4 class="section-title">Levels in this Story</h4>
        <div id="levelGrid" class="cards"></div>
      </div>
    </div>

    <!-- STORYBOOK VIEW -->
<!-- STORYBOOK VIEW -->
<section id="storybookView" class="hidden screen">
  <div class="storybook">

    <button id="closeStory" class="nav-btn" style="position:absolute;top:12px;right:12px;background:#ef4444;box-shadow:0 4px 0 #7f1d1d;">
      ✖ Exit
    </button>

    <div class="storybook-art">
      <img id="storyArt" src="" alt="Story illustration">
    </div>
    <div class="storybook-text" id="storyText"></div>
    <div class="storybook-nav">
      <button id="prevPage" class="nav-btn">⬅ Back</button>
      <div id="pageDots" class="dots"></div>
      <button id="nextPage" class="nav-btn">Next ➡</button>
    </div>
  </div>
</section>


  </div>
</section>

    <!-- GAME -->
    <section id="game">
      <div class="game-top">
        <div><strong id="hudTitle">Creation</strong></div>
        <div>
          <button id="pauseBtn" class="big-btn">⏸ Pause</button>
        </div>
      </div>
      <div class="game-stage">
        <!-- Mini-game placeholder -->
        <button id="finishLevel" class="big-btn">Complete Level</button>
      </div>

      <!-- Pause Overlay -->
      <div id="pauseOverlay" class="overlay">
        <div class="pause">
          <button class="x" id="closePause">✕</button>
          <h3>Settings</h3>
          <div class="row">
            <button class="round" id="toggleSfx">🔊</button>
            <button class="round" id="toggleBgm">🎵</button>
            <button class="round yellow" id="helpBtn">?</button>
            <button class="round blue" id="goHome">🏠</button>
          </div>
          <button class="btn-wide" id="themesBtn">Themes</button>
          <button class="btn-wide" id="friendsBtn">Ask Friends</button>
          <button class="btn-wide red" id="quitBtn">Quit</button>
        </div>
      </div>
    </section>
  </main>

  <!-- BOTTOM NAV -->
  <nav class="bottom">
    <div class="dock">
      <button class="active" data-nav="home"><span class="ico">🏠</span><span>Home</span></button>
      <button data-nav="stories"><span class="ico">📚</span><span>Stories</span></button>
      <button data-nav="ach"><span class="ico">⭐</span><span>Stars</span></button>
      <button data-nav="profile"><span class="ico">👤</span><span>Profile</span></button>
      <button data-nav="shop"><span class="ico">🏬</span><span>Store</span></button>
    </div>
  </nav>
</section>

<script>
/* ----------------- Data ----------------- */
const VERSES = [
  "Psalm 139:14 — I am wonderfully made!",
  "Philippians 4:4 — Rejoice in the Lord always!",
  "Joshua 1:9 — Be strong and brave!",
  "Psalm 118:24 — This is the day the Lord has made; let us be glad!",
  "Matthew 19:14 — Let the children come to me."
];


const STORIES = [
  { id:"creation", name:"Creation", ref:"Genesis 1–2", art:"images/creation.png", levels:3 },
  { id:"noah", name:"Noah’s Ark", ref:"Genesis 6–9", art:"images/noah.png", levels:3 },
  { id:"david", name:"David & Goliath", ref:"1 Samuel 17", art:"images/david.png", levels:3 },
  { id:"daniel", name:"Daniel & Lions", ref:"Daniel 6", art:"images/daniel.png", levels:3 },
  { id:"jonah", name:"Jonah & Fish", ref:"Jonah 1–2", art:"images/jonah.png", levels:3 },
  { id:"nativity", name:"Birth of Jesus", ref:"Luke 2", art:"images/nativity.png", levels:3 },
  { id:"miracles", name:"Jesus’ Miracles", ref:"Gospels", art:"images/miracles.png", levels:3 },
  { id:"samaritan", name:"Good Samaritan", ref:"Luke 10", art:"images/samaritan.png", levels:3 },
  { id:"easter", name:"Easter Story", ref:"Luke 23–24", art:"images/easter.png", levels:3 }
];


/* -------------- State / Progress -------------- */
const KEY = "b33_kids_progress_v1";
const progress = JSON.parse(localStorage.getItem(KEY) || "{}");
/* progress format: { storyId: { clearedLevels: n } } */

/* -------------- Utilities -------------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const save = () => localStorage.setItem(KEY, JSON.stringify(progress));

/* -------------- Splash -> App -------------- */
setTimeout(()=>{ 
  $("#splash").classList.add("hidden");
  $("#app").classList.remove("hidden");
}, 2500);

/* -------------- Ticker -------------- */
let vi = 0;
const tickerSpan = document.querySelector(".ticker span");

function showVerse() {
  tickerSpan.innerText = VERSES[vi % VERSES.length];
  vi++;

  // Reset any old animation
  tickerSpan.style.transition = "none";
  tickerSpan.style.transform = "translateX(100%)";

  // Force browser to reflow so transition restarts clean
  void tickerSpan.offsetWidth;

  // Calculate scroll distance
  const distance = tickerSpan.offsetWidth + tickerSpan.parentElement.offsetWidth;
  const duration = distance / 50; // speed = 25px/s (adjust as needed)

  // Animate leftwards
  tickerSpan.style.transition = `transform ${duration}s linear`;
  tickerSpan.style.transform = `translateX(-${tickerSpan.offsetWidth}px)`;

  // When done, schedule next verse
  setTimeout(showVerse, duration * 1000 + 1000); // +1s pause
}

showVerse();


/* -------------- Story Carousel Render -------------- */
let activeStory = STORIES[0].id;
function storyUnlocked(idx){
  if(idx===0) return true;
  const prev = STORIES[idx-1];
  const p = progress[prev.id]?.clearedLevels || 0;
  return p >= prev.levels; // finish previous story to unlock next
}
function renderStories(){
  const wrap = $("#storyStrip");
  wrap.innerHTML = "";
  STORIES.forEach((s, i)=>{
    const unlocked = storyUnlocked(i);
    const p = progress[s.id]?.clearedLevels || 0;

    const card = document.createElement("article");
    card.className = "book";
   card.innerHTML = `
  <div class="art">
    <img src="${s.art}" alt="${s.name}" style="width:100%;height:100%;object-fit:cover;">
  </div>
  <div class="cap">
    <div class="tag">📖 ${s.name}</div>
    <div style="font-size:12px;color:#765">${s.ref}</div>
    <button class="pill" ${!unlocked?"disabled":""} data-open="${s.id}">
      ${unlocked? (p>=s.levels? "Replay":"Open Book") : "Locked"}
    </button>
  </div>
  ${!unlocked? `<div class="lock"><div class="badge">🔒 Finish prior story</div></div>`:""}
`;

    wrap.appendChild(card);
  });
}
renderStories();

/* -------------- Level Grid Render -------------- */
let currentStoryIdx = 0;
function openStoryById(id){
  const idx = STORIES.findIndex(s=>s.id===id);
  if(idx<0) return;
  currentStoryIdx = idx;
  activeStory = id;
  const s = STORIES[idx];
  $(".section-title").textContent = `Select Level – ${s.name}`;
  renderLevels();
  document.querySelectorAll('.pill').forEach(b=>{
    if(b.dataset.open===id) b.textContent = "Open Book";
  });
}
function levelUnlocked(storyIdx, levelNum){
  if(!storyUnlocked(storyIdx)) return false;
  const s = STORIES[storyIdx];
  const cleared = progress[s.id]?.clearedLevels || 0;
  return levelNum <= cleared + 1;
}
function renderLevels(){
  const grid = $("#levelGrid");
  const s = STORIES[currentStoryIdx];
  const cleared = progress[s.id]?.clearedLevels || 0;
  grid.innerHTML = "";
  for(let i=1;i<=s.levels;i++){
    const card = document.createElement("div");
    card.className = "level-card";
    card.innerHTML = `
      <div class="level-thumb" style="background:url('${s.art}') center/cover no-repeat;"></div>
      <div class="level-foot">
        <span class="level-badge">LEVEL ${String(i).padStart(2,"0")}</span>
        <button class="big-btn playBtn" data-lvl="${i}">Play ▶</button>
      </div>
      ${!levelUnlocked(currentStoryIdx,i)? `<div class="lock-card">🔒 Clear Level ${String(i-1).padStart(2,"0")} first</div>`:""}
    `;
    grid.appendChild(card);
  }
}
openStoryById(activeStory);

/* -------------- Events: open story from pill -------------- */
document.addEventListener("click", (e)=>{
  const t = e.target;

  // open story
if(t.matches("[data-open]")){
  const id = t.getAttribute("data-open");
  const idx = STORIES.findIndex(s=>s.id===id);
  if(storyUnlocked(idx)) {
    openStorybook(id); // open storybook first
  }
}


  // play level
  if(t.classList.contains("playBtn")){
    const lvl = Number(t.dataset.lvl);
    if(!levelUnlocked(currentStoryIdx,lvl)) return;
    startGame(lvl);
  }

  // bottom nav (visual only in this prototype)
  if(t.closest(".dock button")){
    $$(".dock button").forEach(b=>b.classList.remove("active"));
    t.closest(".dock button").classList.add("active");
    if(t.closest("[data-nav='home'],[data-nav='stories']")){
      $("#homeView").scrollIntoView({behavior:"smooth"});
    }
  }
});

/* ----------------- Storybook Logic ----------------- */
let storyPages = [];
let currentPage = 0;

function openStorybook(storyId) {
  const s = STORIES.find(st => st.id === storyId);
  if (!s) return;

  // Example pages (replace with real story text later)
  storyPages = [
    { text: `In the beginning, God created the heavens and the earth.`, art: s.art },
    { text: `God said, "Let there be light," and there was light.`, art: s.art },
    { text: `God made the animals, the plants, and people too!`, art: s.art }
  ];
  currentPage = 0;
  renderStoryPage();

  // Hide home, show storybook
  $("#homeView").classList.add("hidden");
  $("#storybookView").classList.remove("hidden");
}

function renderStoryPage() {
  const storyArt = $("#storyArt");
  const storyText = $("#storyText");

  // Add exit animation classes
  storyArt.classList.add("page-exit");
  storyText.classList.add("page-exit");

  setTimeout(() => {
    // Update content once exit animation is done
    const page = storyPages[currentPage];
    storyArt.src = page.art;
    storyText.textContent = page.text;

    // Reset and apply enter animation
    storyArt.className = "";
    storyText.className = "";
    storyArt.classList.add("page-enter");
    storyText.classList.add("page-enter");

    // Clean up classes after animation finishes
    setTimeout(() => {
      storyArt.className = "";
      storyText.className = "";
    }, 600);

    // --- Dots ---
    const dots = $("#pageDots");
    dots.innerHTML = "";
    storyPages.forEach((_, i) => {
      const dot = document.createElement("span");
      if (i === currentPage) dot.classList.add("active");
      dots.appendChild(dot);
    });

    // --- Buttons ---
    $("#prevPage").disabled = currentPage === 0;
    $("#nextPage").textContent =
      currentPage === storyPages.length - 1 ? "Play ▶" : "Next ➡";
  }, 200); // match exit animation speed
}

// Buttons
$("#prevPage").addEventListener("click", () => {
  if (currentPage > 0) {
    currentPage--;
    renderStoryPage();
  }
});
$("#nextPage").addEventListener("click", () => {
  if (currentPage < storyPages.length - 1) {
    currentPage++;
    renderStoryPage();
  } else {
    // Launch mini-game after last page
    $("#storybookView").classList.add("hidden");
    startGame(1); // Example: start level 1
  }
});
// Close button handler
$("#closeStory").addEventListener("click", () => {
  $("#storybookView").classList.add("hidden");
  $("#homeView").classList.remove("hidden");
});

  
/* -------------- Game Flow (placeholder mini-game) -------------- */
let currentLevel = 1;
function startGame(level){
  currentLevel = level;
  $("#hudTitle").textContent = `${STORIES[currentStoryIdx].name} — Level ${String(level).padStart(2,"0")}`;
  $("#game").style.display = "flex";
  document.body.style.overflow = "hidden";
}
function endGameAndRecord(){
  // mark cleared
  const s = STORIES[currentStoryIdx];
  const cleared = progress[s.id]?.clearedLevels || 0;
  progress[s.id] = { clearedLevels: Math.max(cleared, currentLevel) };
  save();
  // return to home
  $("#game").style.display = "none";
  document.body.style.overflow = "";
  renderStories();
  renderLevels();
}

/* Demo: Complete level button */
$("#finishLevel").addEventListener("click", endGameAndRecord);

/* Pause overlay */
const showPause = (v)=> $("#pauseOverlay").style.display = v?"flex":"none";
$("#pauseBtn").addEventListener("click", ()=> showPause(true));
$("#closePause").addEventListener("click", ()=> showPause(false));
$("#goHome").addEventListener("click", ()=>{
  showPause(false);
  $("#game").style.display="none";
  document.body.style.overflow="";
});
$("#quitBtn").addEventListener("click", ()=>{
  showPause(false);
  $("#game").style.display="none";
  document.body.style.overflow="";
});

/* Settings gear simply opens pause for this prototype */
$("#openSettings").addEventListener("click", ()=> showPause(true));

/* -------------- Keyboard helpers for quick testing -------------- */
document.addEventListener("keydown", (e)=>{
  if(e.key==="Escape"){ showPause(true); }
});

/* attach handlers to dynamic items */
document.addEventListener("click",(e)=>{
  if(e.target.id==="toggleSfx"){ e.target.classList.toggle("ghost"); }
  if(e.target.id==="toggleBgm"){ e.target.classList.toggle("ghost"); }
  if(e.target.id==="helpBtn"){ alert("Help: finish each story’s levels to unlock the next book."); }
});
</script>
</body>
</html>
